<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>OpoPlataforma ‚Äì Ley 39/2015</title>
  <style>
    body { margin:0; background:#111; color:#fff; font-family:Arial, sans-serif; }
    #ui { padding:10px; background:#222; }
    canvas { display:block; margin:0 auto; background:#5c94fc; }
    #quiz { display:none; padding:10px; background:#333; }
    button { margin-top:8px; }
  </style>
</head>
<body>
  <div id="ui">üìò OpoPlataforma ‚Äì Aprende la Ley 39/2015 saltando obst√°culos</div>
  <canvas id="game" width="800" height="400"></canvas>
  <div id="quiz"></div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const quizDiv = document.getElementById('quiz');

let player = { x:50, y:300, w:30, h:30, vy:0, onGround:false };
let gravity = 0.8;
let platforms = [
  {x:0,y:350,w:800,h:50},
  {x:200,y:280,w:120,h:20},
  {x:400,y:230,w:120,h:20}
];

let books = [
  {x:220,y:250, q:0},
  {x:420,y:200, q:1}
];

const questions = [
  {
    q: '¬øCu√°l es el objeto de la Ley 39/2015?',
    a: ['Regular el procedimiento administrativo com√∫n','Regular solo sanciones','Regular contratos p√∫blicos'],
    ok: 0
  },
  {
    q: '¬øQui√©nes tienen capacidad de obrar?',
    a: ['Solo espa√±oles','Personas f√≠sicas y jur√≠dicas','Solo funcionarios'],
    ok: 1
  }
];

let keys = {};
window.addEventListener('keydown', e => keys[e.key] = true);
window.addEventListener('keyup', e => keys[e.key] = false);

function update() {
  if (keys['ArrowRight']) player.x += 4;
  if (keys['ArrowLeft']) player.x -= 4;
  if (keys[' '] && player.onGround) {
    player.vy = -12;
    player.onGround = false;
  }

  player.vy += gravity;
  player.y += player.vy;

  player.onGround = false;
  platforms.forEach(p => {
    if (player.x < p.x+p.w && player.x+player.w > p.x &&
        player.y < p.y+p.h && player.y+player.h > p.y) {
      if (player.vy > 0) {
        player.y = p.y - player.h;
        player.vy = 0;
        player.onGround = true;
      }
    }
  });

  books.forEach((b, i) => {
    if (b && player.x < b.x+20 && player.x+player.w > b.x &&
        player.y < b.y+20 && player.y+player.h > b.y) {
      showQuiz(b.q);
      books[i] = null;
    }
  });
}

function draw() {
  ctx.clearRect(0,0,800,400);
  ctx.fillStyle = '#654321';
  platforms.forEach(p => ctx.fillRect(p.x,p.y,p.w,p.h));

  ctx.fillStyle = '#ff0';
  books.forEach(b => b && ctx.fillRect(b.x,b.y,20,20));

  ctx.fillStyle = '#f00';
  ctx.fillRect(player.x,player.y,player.w,player.h);
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

function showQuiz(i) {
  quizDiv.style.display = 'block';
  quizDiv.innerHTML = `<strong>${questions[i].q}</strong><br>` +
    questions[i].a.map((t,idx)=>
      `<button onclick="answer(${i},${idx})">${t}</button><br>`
    ).join('');
}

function answer(q,i) {
  if (i === questions[q].ok) alert('‚úÖ Correcto');
  else alert('‚ùå Incorrecto');
  quizDiv.style.display = 'none';
}

loop();
</script>
</body>
</html>
